<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Select Your Level</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(to bottom, #96e6a1);
      text-align: center;
      padding: 50px;
    }
    h1 {
      color: #2e7d32;
    }
    .levels-container {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin-top: 40px;
      flex-wrap: wrap;
    }
    .level-box {
      background: #388e3c;
      color: white;
      border-radius: 12px;
      width: 300px;
      height: 400px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.4em;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      transition: background 0.3s, transform 0.2s;
      text-decoration: none;
    }
    .level-box:hover {
      background: #1b5e20;
      transform: translateY(-5px) scale(1.04);
    }
    .locked {
      background: gray !important;
      cursor: not-allowed;
      pointer-events: none;
    }
  </style>
</head>
<body>

  <h1>Choose Your Level</h1>

  <div class="levels-container">
    <a id="level1" href="page3.html" class="level-box">Level 1</a>
    <a id="level2" href="page4.html" class="level-box">Level 2</a>
    <a id="level3" href="page5.html" class="level-box">Level 3</a>
    <a id="level4" href="page6.html" class="level-box">Level 4</a>
  </div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
  import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBa_wF-wp2v42mLNic1_R1a7w0skWV94b8",
    authDomain: "useless-ecf5e.firebaseapp.com",
    projectId: "useless-ecf5e",
    storageBucket: "useless-ecf5e.firebasestorage.app",
    messagingSenderId: "399978256767",
    appId: "1:399978256767:web:2bb6f882fc03074bd5224a",
    measurementId: "G-2RHWZRZKHR"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // Get player's phone from localStorage (saved in signup)
  const playerPhone = localStorage.getItem("playerPhone");
  if (!playerPhone) {
    alert("No player found, please sign up first.");
    window.location.href = "signup.html";
  }

  async function checkAccess() {
    const q = query(collection(db, "players"), where("phone", "==", playerPhone));
    const snapshot = await getDocs(q);
    if (snapshot.empty) {
      alert("Player not found. Please sign up again.");
      window.location.href = "signup.html";
      return;
    }

    let currentLevel = 1;
    snapshot.forEach(doc => {
      currentLevel = doc.data().currentLevel || 1;
    });

    // Lock levels above currentLevel
    for (let i = currentLevel + 1; i <= 4; i++) {
      document.getElementById(`level${i}`).classList.add("locked");
    }
  }

  checkAccess();
</script>

</body>
</html>
